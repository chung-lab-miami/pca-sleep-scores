<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCA Sleep Health Scores & Mortality Prediction | Joon Chung, PhD</title>
    <style>
        :root {
            --primary: #1a365d;
            --accent: #2b6cb0;
            --accent-light: #ebf4ff;
            --success: #276749;
            --success-light: #f0fff4;
            --warning: #975a16;
            --warning-light: #fffff0;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --bg: #f7fafc;
            --highlight: #c3dafe;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--text);
            line-height: 1.6;
            background: var(--bg);
        }
        .container { max-width: 960px; margin: 0 auto; padding: 0 20px; }

        /* Hero Header */
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 60%, #3182ce 100%);
            color: white;
            padding: 48px 0 40px;
        }
        header h1 { font-size: 2em; margin-bottom: 6px; letter-spacing: -0.5px; }
        header .subtitle { font-size: 1.15em; opacity: 0.92; margin-bottom: 20px; max-width: 700px; }
        header .meta { font-size: 0.9em; opacity: 0.75; }
        header .meta a { color: white; }

        /* Impact Banner */
        .impact-banner {
            background: white;
            margin: -28px 20px 0;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        .impact-stat {
            text-align: center;
            padding: 28px 16px;
            border-right: 1px solid var(--border);
        }
        .impact-stat:last-child { border-right: none; }
        .impact-stat .number {
            font-size: 2.2em;
            font-weight: 800;
            color: var(--accent);
            line-height: 1.1;
        }
        .impact-stat .number.highlight {
            color: var(--success);
        }
        .impact-stat .label {
            font-size: 0.82em;
            color: var(--text-light);
            margin-top: 6px;
            line-height: 1.3;
        }
        @media (max-width: 700px) {
            .impact-banner { grid-template-columns: repeat(2, 1fr); }
            .impact-stat { border-bottom: 1px solid var(--border); }
        }

        /* TL;DR */
        .tldr {
            background: white;
            border-left: 5px solid var(--accent);
            padding: 24px;
            margin: 32px 0 24px;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .tldr h2 { color: var(--accent); margin-bottom: 12px; font-size: 1.2em; }
        .tldr p { font-size: 1em; margin-bottom: 8px; }
        .tldr .bottom-line {
            background: var(--accent-light);
            padding: 12px 16px;
            border-radius: 6px;
            margin-top: 12px;
            font-weight: 600;
            font-size: 0.95em;
        }

        /* Skill Cards */
        .skills { margin: 24px 0; }
        .skills h2 { font-size: 1.4em; margin-bottom: 16px; color: var(--primary); }
        .skill-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
        .skill-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-top: 3px solid var(--accent);
        }
        .skill-card h3 { font-size: 1.05em; margin-bottom: 4px; color: var(--primary); }
        .skill-card .role { font-size: 0.8em; color: var(--accent); font-weight: 600; margin-bottom: 8px; }
        .skill-card p { font-size: 0.9em; color: var(--text-light); margin-bottom: 10px; }
        .tag {
            display: inline-block;
            background: var(--accent-light);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.78em;
            margin: 2px 2px;
            font-weight: 500;
        }

        /* Key Results */
        .results {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .results h2 { color: var(--primary); margin-bottom: 16px; }

        /* Section styling */
        section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin: 24px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        section h2 { color: var(--primary); margin-bottom: 16px; font-size: 1.3em; }
        section h3 { color: var(--accent); margin: 16px 0 8px; font-size: 1.1em; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 0.9em; }
        th { background: var(--primary); color: white; padding: 10px 12px; text-align: left; font-weight: 600; }
        td { padding: 8px 12px; border-bottom: 1px solid var(--border); }
        tr:hover { background: var(--accent-light); }

        /* Collapsible */
        details { margin: 12px 0; }
        summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--accent);
            padding: 10px 0;
            font-size: 1em;
            list-style: none;
        }
        summary::-webkit-details-marker { display: none; }
        summary::before {
            content: '\25B6';
            display: inline-block;
            margin-right: 8px;
            font-size: 0.7em;
            transition: transform 0.2s;
        }
        details[open] > summary::before { transform: rotate(90deg); }
        summary:hover { color: var(--primary); }

        /* Code blocks */
        code {
            background: #edf2f7;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.88em;
            font-family: 'SF Mono', 'Fira Code', monospace;
        }
        pre {
            background: #1a202c;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.85em;
            line-height: 1.5;
        }
        pre code { background: none; padding: 0; color: inherit; }

        /* Data flow diagram */
        .flow-diagram {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            font-family: monospace;
            font-size: 0.85em;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.4;
        }

        /* Status badges */
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .badge-green { background: var(--success-light); color: var(--success); }
        .badge-yellow { background: var(--warning-light); color: var(--warning); }

        /* Footer */
        footer {
            background: var(--primary);
            color: white;
            padding: 24px 0;
            margin-top: 40px;
            font-size: 0.9em;
        }
        footer a { color: #90cdf4; }

        /* Issue list */
        .issue {
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }
        .issue-low { border-color: #38a169; background: #f0fff4; }
        .issue-medium { border-color: #d69e2e; background: #fffff0; }
        .issue-high { border-color: #e53e3e; background: #fff5f5; }
        .issue .severity { font-weight: 700; font-size: 0.85em; text-transform: uppercase; }
        .issue .desc { margin-top: 4px; font-size: 0.9em; }

        /* C-statistic ranking table */
        .c-stat-table td:nth-child(2),
        .c-stat-table td:nth-child(3) { font-family: 'SF Mono', monospace; text-align: center; }
        .c-stat-table th:nth-child(2),
        .c-stat-table th:nth-child(3) { text-align: center; }
        .c-stat-table .winner { background: var(--accent-light); font-weight: 700; }

        /* Pipeline overview */
        .pipeline-overview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin: 16px 0;
        }
        .pipeline-phase {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
        }
        .pipeline-phase h4 {
            font-size: 0.9em;
            color: var(--primary);
            margin-bottom: 6px;
        }
        .pipeline-phase .scripts {
            font-size: 0.82em;
            color: var(--text-light);
        }

        /* Pub card */
        .pub-card {
            border-left: 3px solid var(--accent);
            padding: 12px 16px;
            margin: 10px 0;
            background: var(--bg);
            border-radius: 0 6px 6px 0;
        }
        .pub-card .pub-label {
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 4px;
        }
        .pub-card .pub-title { font-size: 0.92em; }
        .pub-card a { color: var(--accent); }
    </style>
</head>
<body>

<header>
    <div class="container">
        <h1>Predicting Mortality from Multidimensional Sleep Data</h1>
        <div class="subtitle">PCA-derived composite sleep score outperforms every individual metric in a 1,726-person cohort study</div>
        <div class="meta">
            <strong>Joon Chung, PhD</strong> &mdash; University of Miami, Miller School of Medicine<br>
            Originally conducted at Brigham and Women's Hospital / Harvard Medical School (2021&ndash;2022)
        </div>
    </div>
</header>

<div class="container">

    <!-- Impact Banner (above-the-fold numbers) -->
    <div class="impact-banner">
        <div class="impact-stat">
            <div class="number highlight">25%</div>
            <div class="label">Lower mortality risk<br>per SD of PC1</div>
        </div>
        <div class="impact-stat">
            <div class="number">0.617</div>
            <div class="label">C-statistic (best<br>among 14 metrics)</div>
        </div>
        <div class="impact-stat">
            <div class="number">13</div>
            <div class="label">Multimodal sleep<br>variables fused</div>
        </div>
        <div class="impact-stat">
            <div class="number">26</div>
            <div class="label">R scripts in<br>analysis pipeline</div>
        </div>
    </div>

    <!-- TL;DR -->
    <div class="tldr">
        <h2>TL;DR</h2>
        <p>Sleep is multidimensional&mdash;duration, quality, regularity, architecture, and apnea all matter.
        Rather than testing each in isolation, I used <strong>principal component analysis (PCA)</strong> to compress
        13 sleep indicators from wearable actigraphy, polysomnography, and questionnaires into a single data-driven score.</p>
        <p>That composite (PC1) achieved the <strong>highest predictive accuracy for mortality</strong> (C = 0.617) of any metric tested,
        beating both the raw sum score and every individual sleep variable.</p>
        <div class="bottom-line">
            HR = 0.75 (95% CI: 0.65&ndash;0.87) &mdash; each standard deviation increase in the composite score
            was associated with 25% lower all-cause mortality over ~8 years of follow-up (N = 1,726; 171 deaths).
        </div>
    </div>

    <!-- Technical Skills -->
    <div class="skills">
        <h2>Technical Skills Demonstrated</h2>
        <div class="skill-grid">
            <div class="skill-card">
                <h3>Dimensionality Reduction</h3>
                <div class="role">ML / Data Science</div>
                <p>PCA on 13 multimodal features; bootstrap stability validation; reduced-variable sensitivity analysis</p>
                <span class="tag">PCA</span>
                <span class="tag">prcomp</span>
                <span class="tag">Bootstrap</span>
                <span class="tag">Eigenvalue analysis</span>
                <span class="tag">factoextra</span>
            </div>
            <div class="skill-card">
                <h3>Survival Analysis</h3>
                <div class="role">Biostatistics / Clinical</div>
                <p>Cox PH with nested progressive adjustment, penalized splines for non-linearity, age-as-time-metric sensitivity</p>
                <span class="tag">Cox PH</span>
                <span class="tag">Kaplan-Meier</span>
                <span class="tag">pspline</span>
                <span class="tag">cox.zph</span>
                <span class="tag">survminer</span>
            </div>
            <div class="skill-card">
                <h3>Predictive Model Evaluation</h3>
                <div class="role">ML Engineering / Validation</div>
                <p>Head-to-head C-statistics, time-dependent AUC (1&ndash;8 yr), Cox R&sup2;, IPA, and LR tests across 15+ metrics</p>
                <span class="tag">C-statistic</span>
                <span class="tag">Somers' D<sub>xy</sub></span>
                <span class="tag">Time-dep AUC</span>
                <span class="tag">riskRegression</span>
            </div>
            <div class="skill-card">
                <h3>Feature Engineering</h3>
                <div class="role">Data Engineering</div>
                <p>13 sleep indicators from 3 modalities; AEHI-10 dietary composite with sex-specific scoring; circular variable handling</p>
                <span class="tag">Multi-source fusion</span>
                <span class="tag">AEHI-10</span>
                <span class="tag">Circular variables</span>
                <span class="tag">Clinical thresholds</span>
            </div>
            <div class="skill-card">
                <h3>Programmatic Modeling</h3>
                <div class="role">Software Engineering</div>
                <p>Loop-based Cox regression over 27 predictors; automated forest plot generation; batch model comparison</p>
                <span class="tag">Parametric loops</span>
                <span class="tag">Forest plots</span>
                <span class="tag">ggplot2</span>
                <span class="tag">gridExtra</span>
            </div>
            <div class="skill-card">
                <h3>Data Engineering</h3>
                <div class="role">Data Engineering / ETL</div>
                <p>26-script reproducible pipeline merging 6 MESA exam waves, PSG, actigraphy, diet FFQ, and mortality events</p>
                <span class="tag">dplyr pipelines</span>
                <span class="tag">Multi-wave merge</span>
                <span class="tag">haven / foreign</span>
                <span class="tag">labelled</span>
            </div>
        </div>
    </div>

    <!-- Key Results: C-Statistic Ranking -->
    <section class="results">
        <h2>Key Results: PC1 Outperforms Every Individual Sleep Metric</h2>

        <details open>
            <summary>C-Statistic Ranking (14 Continuous Metrics)</summary>
            <table class="c-stat-table">
                <thead>
                    <tr><th>Sleep Metric</th><th>C-statistic</th><th>D<sub>xy</sub></th><th>p-value</th></tr>
                </thead>
                <tbody>
                    <tr class="winner"><td>PC1 (PCA composite score)</td><td>0.617</td><td>0.234</td><td>&lt;0.0001</td></tr>
                    <tr><td>% N3 (slow-wave sleep)</td><td>0.587</td><td>0.174</td><td>0.0001</td></tr>
                    <tr><td>% R (REM)</td><td>0.587</td><td>0.173</td><td>0.0001</td></tr>
                    <tr><td>SHS (raw sum of 13 indicators)</td><td>0.586</td><td>0.172</td><td>&lt;0.0001</td></tr>
                    <tr><td>Total sleep time</td><td>0.567</td><td>0.135</td><td>0.0072</td></tr>
                    <tr><td>ESS (sleepiness)</td><td>0.520</td><td>0.040</td><td>0.3718</td></tr>
                    <tr><td>Sleep maintenance efficiency</td><td>0.494</td><td>0.012</td><td>0.7996</td></tr>
                    <tr><td>Quality</td><td>0.493</td><td>0.015</td><td>0.7366</td></tr>
                    <tr><td>Timing variability</td><td>0.470</td><td>0.059</td><td>0.2115</td></tr>
                    <tr><td>Duration irregularity (SD)</td><td>0.439</td><td>0.122</td><td>0.0058</td></tr>
                    <tr><td>Midpoint irregularity</td><td>0.435</td><td>0.130</td><td>0.0040</td></tr>
                    <tr><td>Fragmentation</td><td>0.428</td><td>0.143</td><td>0.0013</td></tr>
                    <tr><td>AHI (sleep apnea)</td><td>0.417</td><td>0.167</td><td>0.0001</td></tr>
                    <tr><td>WASO</td><td>0.373</td><td>0.254</td><td>&lt;0.0001</td></tr>
                </tbody>
            </table>
            <p style="font-size:0.82em; color:var(--text-light); margin-top:8px;">
                Harrell's <code>rcorrcens()</code> (Hmisc). N = 1,726 participants; 171 deaths over ~8 years.
            </p>
        </details>
    </section>

    <!-- Publications -->
    <section>
        <h2>Peer-Reviewed Publications</h2>
        <div class="pub-card">
            <div class="pub-label">Primary Paper</div>
            <div class="pub-title">
                Chung J, Goodman M, Huang T, Wallace ML, Lutsey PL, Chen JT, Castro-Diehl C, Bertisch S, Redline S.
                Multi-dimensional sleep and mortality: The Multi-Ethnic Study of Atherosclerosis.
                <em>SLEEP</em>. 2023;46(9):zsad048.
                <a href="https://doi.org/10.1093/sleep/zsad048" target="_blank">doi:10.1093/sleep/zsad048</a>
            </div>
        </div>
        <div class="pub-card">
            <div class="pub-label">Conceptual Framework</div>
            <div class="pub-title">
                Chung J, Goodman M, Huang T, Bertisch S, Redline S.
                Multidimensional sleep health in a diverse, aging adult cohort.
                <em>Sleep Health</em>. 2021;7(6):699&ndash;707.
                <a href="https://doi.org/10.1016/j.sleh.2021.08.005" target="_blank">doi:10.1016/j.sleh.2021.08.005</a>
            </div>
        </div>
        <div class="pub-card">
            <div class="pub-label">Racial Disparities</div>
            <div class="pub-title">
                Chung J, Goodman M, Huang T, Wallace ML, Johnson DA, Bertisch S, Redline S.
                Racial/Ethnic Differences in Indicators of Healthy Sleep.
                <em>Am J Epidemiol</em>. 2024;193(1):107&ndash;120.
                <a href="https://doi.org/10.1093/aje/kwab232" target="_blank">doi:10.1093/aje/kwab232</a>
            </div>
        </div>
    </section>

    <!-- Pipeline Overview (visual, not detailed) -->
    <section>
        <h2>Analysis Pipeline (26 R Scripts)</h2>
        <div class="pipeline-overview">
            <div class="pipeline-phase">
                <h4>Data Import &amp; Cleaning</h4>
                <div class="scripts">Scripts 01&ndash;04 &bull; 824 lines<br>6 MESA exam waves, PSG, actigraphy, diet FFQ, mortality events merged into analytical dataset (N&nbsp;=&nbsp;1,726)</div>
            </div>
            <div class="pipeline-phase">
                <h4>PCA &amp; Composite Scoring</h4>
                <div class="scripts">Script 02 (core) &bull; 305 lines<br>13 sleep variables &rarr; <code>prcomp()</code> &rarr; PC1 composite + raw SHS sum</div>
            </div>
            <div class="pipeline-phase">
                <h4>Survival Modeling</h4>
                <div class="scripts">Scripts 05&ndash;06 &bull; 478 lines<br>Nested Cox PH, splines, 27-predictor loop, forest plots</div>
            </div>
            <div class="pipeline-phase">
                <h4>Model Comparison</h4>
                <div class="scripts">Scripts 17&ndash;22 &bull; 1,306 lines<br>C-statistics, time-dependent AUC, Cox R&sup2;, LR tests, IPA</div>
            </div>
            <div class="pipeline-phase">
                <h4>Sensitivity &amp; Validation</h4>
                <div class="scripts">Scripts 07&ndash;14, 23&ndash;26 &bull; 1,261 lines<br>PSM, bootstrap PCA, reduced-variable PCA, reverse causation</div>
            </div>
            <div class="pipeline-phase">
                <h4>Tables &amp; Figures</h4>
                <div class="scripts">Scripts 08&ndash;11 &bull; 301 lines<br>Publication-quality outputs, Kaplan-Meier curves, TableOne</div>
            </div>
        </div>

        <!-- Collapsible detailed script list -->
        <details>
            <summary>Full Script-by-Script Details</summary>

            <h3>01 &mdash; Import &amp; Clean (199 lines)</h3>
            <p>Merges 6 MESA exam waves with PSG, actigraphy, and sleep questionnaire data. Recodes demographics
            (sex, age, race/ethnicity), socioeconomic variables (education in 4 tiers, income tertiles),
            depressive symptoms (CES-D minus sleep item), smoking status, physical activity, and BMI.</p>

            <h3>02 &mdash; Sleep Variables &amp; PCA Construction (305 lines)</h3>
            <p><strong>Core PCA implementation.</strong> Constructs 13 sleep indicators from actigraphy (TST, SME, fragmentation, MPSD, SDTST),
            PSG (SWS%, REM%, AHI, WASO), and questionnaire (ESS, quality, SOL) data. Dichotomizes each at clinical thresholds.
            Handles circular timing variable. Runs PCA via <code>prcomp(scale(pr_df[,1:13]*-1))</code> &mdash;
            the <code>*-1</code> ensures higher PC1 = better sleep health.
            Extracts eigenvalues, loadings, and PC1 scores.</p>

            <h3>03 &mdash; Diet &amp; Covariates (181 lines)</h3>
            <p>Implements the Alternative Healthy Eating Index (AEHI-10) from MESA FFQ data.
            Scores 10 sex-specific dietary components (vegetables, fruit, whole grains, legumes, meat, trans fat,
            omega-3, PUFA, sodium, alcohol).</p>

            <h3>04 &mdash; Analytical Dataset (139 lines)</h3>
            <p>Merges all variables into <code>shs_df</code> (N&nbsp;=&nbsp;1,726). Computes follow-up time,
            prevalent disease indicators, standardized SHS, and applies variable labels.</p>

            <h3>05 &mdash; Cox PH Models (162 lines)</h3>
            <p>Primary survival analysis. Nested models with progressive adjustment:
            sociodemographic &rarr; + lifestyle + diet &rarr; + BMI + prevalent CVD.
            Tests proportional hazards (global p&nbsp;=&nbsp;0.272) and non-linearity (splines, quadratic).
            Sensitivity: excludes 18 deaths within 1 year.</p>

            <h3>06 &mdash; Individual Metric Regressions (316 lines)</h3>
            <p>Loop-based Cox over 13 dichotomous and 14 continuous predictors.
            Extracts HRs and 95% CIs; generates forest plots. Reverse-codes unfavorable metrics.</p>

            <h3>07 &mdash; Propensity Score Matching (342 lines)</h3>
            <p>Full matching with probit link. Five balance specifications (parsimonious to 36 covariates). Love plots.</p>

            <h3>08&ndash;11 &mdash; Tables, Figures, Survival Plots (301 lines total)</h3>
            <p>TableOne descriptive statistics, spline-modeled individual variables, KM curves, PC1 tertile supplementary analysis.</p>

            <h3>12 &mdash; Sensitivity: Exclude Early Deaths (129 lines)</h3>
            <p>Reverse causation test: recodes 18 deaths within 1 year as censored; re-runs Cox models.</p>

            <h3>13&ndash;14 &mdash; Alternative Scores &amp; Additional Covariates (231 lines)</h3>
            <p>Alternative composite constructions; adds cancer history and medication count.</p>

            <h3>16 &mdash; PC1 Ranked (36 lines)</h3>
            <p>Rank-normalizes PC1 and fits Cox on rank-transformed predictor.</p>

            <h3>17 &mdash; C-Statistics (582 lines)</h3>
            <p><strong>Key discrimination script.</strong> Harrell's <code>rcorrcens()</code> for Somers' D<sub>xy</sub>
            across all 14 continuous and 13 dichotomous metrics. Builds head-to-head comparison: PC1 (C&nbsp;=&nbsp;0.617)
            vs.&nbsp;SHS (C&nbsp;=&nbsp;0.586) vs.&nbsp;individual metrics. Publication-quality ROC plots.</p>

            <h3>18 &mdash; Time-Dependent AUC (466 lines)</h3>
            <p><code>riskRegression::Score()</code> at yearly intervals (1&ndash;8 yr). Compares base model
            vs.&nbsp;base&nbsp;+&nbsp;PC1, SHS, or individual metrics. AUC trajectory plots.</p>

            <h3>20 &mdash; Integrated Prediction Accuracy (81 lines)</h3>
            <p>IPA at 500&ndash;3000 day horizons.</p>

            <h3>21 &mdash; Cox R&sup2; (69 lines)</h3>
            <p>Explained variation via <code>survMisc::rsq()</code>: MEV, MER, coefficient of determination for 15 continuous
            and 8 dichotomous predictors.</p>

            <h3>22 &mdash; Likelihood Ratio Tests (108 lines)</h3>
            <p>Formal LR tests comparing nested models (base vs.&nbsp;base + sleep predictor).</p>

            <h3>23&ndash;26 &mdash; Additional Sensitivity (274 lines total)</h3>
            <p>Additional robustness checks, Cox predictions, reduced 7-variable PCA (objective metrics only),
            and peer-review-requested analyses.</p>

            <h3>Standalone: PCA Extraction (57 lines) + Bootstrap Validation (23 lines)</h3>
            <p>Standalone PCA extraction code and bootstrap resampling stability test (n&nbsp;=&nbsp;1,740 with replacement).</p>
        </details>
    </section>

    <!-- Methods (collapsed by default) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">Methods Summary</summary>

            <details style="margin-top:12px;">
                <summary>PCA Construction</summary>
                <ul>
                    <li><strong>Input:</strong> 13 sleep variables scaled to z-scores, multiplied by &ndash;1 (higher = better)</li>
                    <li><strong>Method:</strong> <code>prcomp()</code> (singular value decomposition)</li>
                    <li><strong>PC1:</strong> Overall sleep quality/consolidation factor (19.75% variance explained)</li>
                    <li><strong>Strongest loadings:</strong> Fragmentation (&ndash;0.44), SME (+0.41), TST (+0.33), AHI (&ndash;0.32), WASO (&ndash;0.32)</li>
                    <li><strong>Validation:</strong> Bootstrap resampling (1,740 iterations), reduced 7-variable sensitivity</li>
                </ul>
            </details>
            <details>
                <summary>Cox Proportional Hazards Models</summary>
                <ul>
                    <li><strong>Outcome:</strong> <code>Surv(dthtt - slpexam1, death)</code></li>
                    <li><strong>Progressive adjustment:</strong> Sociodemographic &rarr; + Lifestyle + Diet &rarr; + BMI + Prevalent CVD</li>
                    <li><strong>Assumption testing:</strong> Schoenfeld residuals (global p = 0.272), penalized splines (non-linear p = 0.55)</li>
                    <li><strong>Sensitivity:</strong> Reverse causation (exclude deaths &lt;1 year), rank-normalized PC1</li>
                </ul>
            </details>
            <details>
                <summary>Predictive Model Comparison</summary>
                <ul>
                    <li><strong>C-statistic:</strong> Harrell's <code>rcorrcens()</code> &mdash; Somers' D<sub>xy</sub> concordance</li>
                    <li><strong>Time-dependent AUC:</strong> <code>riskRegression::Score()</code> at 1&ndash;8 year horizons</li>
                    <li><strong>Cox R&sup2;:</strong> <code>survMisc::rsq()</code> &mdash; MEV, MER, coefficient of determination</li>
                    <li><strong>LR tests:</strong> Nested model comparison (base vs. base + sleep predictor)</li>
                    <li><strong>Integrated Prediction Accuracy (IPA):</strong> 500&ndash;3000 day horizons</li>
                </ul>
            </details>
        </details>
    </section>

    <!-- Study Design (collapsed) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">Study Design &amp; Data</summary>
            <table style="margin-top:12px;">
                <tr><td><strong>Cohort</strong></td><td>Multi-Ethnic Study of Atherosclerosis (MESA), Exam 5 Sleep Study (2010&ndash;2012)</td></tr>
                <tr><td><strong>Sample</strong></td><td>N = 1,726 with complete sleep + mortality data (171 deaths)</td></tr>
                <tr><td><strong>Data sources</strong></td><td>Wrist actigraphy (7 days), polysomnography (PSG), Epworth Sleepiness Scale, sleep quality questionnaire</td></tr>
                <tr><td><strong>PCA variables</strong></td><td>13: TST, SME, log(MPSD), ESS, quality, fragmentation, SWS%, REM%, AHI, WASO, SOL, SD(TST), log(timing)</td></tr>
                <tr><td><strong>Outcome</strong></td><td>All-cause mortality through 2018 (~8 years follow-up)</td></tr>
            </table>

            <h3 style="margin-top:20px;">Data Flow</h3>
            <div class="flow-diagram">
MESA Exam 1&ndash;6      PSG         Actigraphy     Sleep Q       Diet FFQ       Events
(demographics)   (sleep arch)   (7-day wear)   (ESS, qual)   (AEHI-10)     (mortality)
      |              |              |              |              |              |
      +-------+------+--------------+--------------+------+-------+--------------+
              |                                           |
        [01: Import &amp; Clean]                     [03: Diet &amp; Covariates]
              |                                           |
        [02: Sleep Variables &amp; PCA]                       |
              |                                           |
        [04: Analytical Dataset (shs_df)]&lt;----------------+
              |
    +---------+---------+---------+---------+---------+
    |         |         |         |         |         |
 [05:Cox]  [06:Ind]  [07:PSM]  [08:Spline] ...   [26:Sens]
    |         |         |         |
 [17:C-stat] [18:AUC] [21:R2]  [22:LR]
            </div>
        </details>
    </section>

    <!-- R Packages (collapsed) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">R Packages Used</summary>
            <table style="margin-top:12px;">
                <thead><tr><th>Package</th><th>Purpose</th></tr></thead>
                <tbody>
                    <tr><td><code>survival</code></td><td>Cox PH models, Surv objects, cox.zph</td></tr>
                    <tr><td><code>survminer</code></td><td>Kaplan-Meier plots, ggsurvplot</td></tr>
                    <tr><td><code>survMisc</code></td><td>Cox R&sup2; (rsq function)</td></tr>
                    <tr><td><code>riskRegression</code></td><td>Time-dependent AUC, Score(), plotROC</td></tr>
                    <tr><td><code>rms</code> / <code>Hmisc</code></td><td>C-statistics, Somers' D<sub>xy</sub>, rcorrcens</td></tr>
                    <tr><td><code>factoextra</code> / <code>FactoMineR</code></td><td>PCA computation and visualization</td></tr>
                    <tr><td><code>tableone</code></td><td>Descriptive statistics (Table 1)</td></tr>
                    <tr><td><code>dplyr</code> / <code>tidyverse</code></td><td>Data wrangling pipelines</td></tr>
                    <tr><td><code>ggplot2</code> / <code>gridExtra</code></td><td>Publication-quality multi-panel figures</td></tr>
                    <tr><td><code>haven</code> / <code>foreign</code></td><td>Stata .dta file import</td></tr>
                    <tr><td><code>labelled</code></td><td>Variable label management</td></tr>
                </tbody>
            </table>
        </details>
    </section>

    <!-- Code Review Notes (collapsed) -->
    <section>
        <details>
            <summary style="font-size:1.2em; color:var(--primary);">Code Review Notes</summary>

            <div class="issue issue-medium">
                <div class="severity">Medium &mdash; set.seed Placement</div>
                <div class="desc"><code>set.seed(8675309)</code> appears in script 02 but not consistently across all scripts
                with stochastic operations. Reproducibility is maintained within sessions but could diverge across runs.</div>
            </div>

            <div class="issue issue-low">
                <div class="severity">Low &mdash; Magic Numbers</div>
                <div class="desc">Clinical thresholds (TST 360&ndash;480 min, SME &gt;90%, AHI &le;15) are inline rather than in a config.
                All thresholds are sourced from published guidelines (NSF, AASM) and documented in comments.</div>
            </div>

            <div class="issue issue-low">
                <div class="severity">Low &mdash; Script 15 (Random Forests) Empty</div>
                <div class="desc">Placeholder script with 0 lines. Planned ML extension was not implemented in the final pipeline.</div>
            </div>

            <div class="issue issue-low">
                <div class="severity">Low &mdash; Duplicate Script Numbers</div>
                <div class="desc">Two scripts numbered "07" and two numbered "10". Non-breaking but could cause confusion.</div>
            </div>
        </details>
    </section>

</div>

<footer>
    <div class="container">
        <strong>Joon Chung, PhD</strong> &mdash; University of Miami, Miller School of Medicine<br>
        Originally conducted at Brigham and Women's Hospital / Harvard Medical School (2021&ndash;2022)<br>
        <a href="https://github.com/chung-lab-miami">github.com/chung-lab-miami</a>
    </div>
</footer>

</body>
</html>
